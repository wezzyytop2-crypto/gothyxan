<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HOME — GOTYXAN-PRO</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script> 
    <script src="firebase-config.js"></script>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="logo">
                <span>GOTYXAN</span><span>-PRO</span>
            </a>
            <ul class="nav-menu" id="main-nav-menu">
                <li><a href="index.html" class="active">HOME</a></li>
                <li><a href="shop.html">SHOP</a></li>
                <li><a href="cart.html">CART <span class="cart-count">0</span></a></li>
                
                <li id="auth-link-1"><a href="login.html">LOGIN</a></li>
                <li id="auth-link-2"><a href="register.html">REGISTER</a></li>
                </ul>
        </div>
    </nav>
    <section class="main-section">
        <div class="container">
            <h2 class="section-title" style="margin-top: 50px;">CURRENT SELECTION</h2>
            
            <div id="welcome-message" style="text-align: center; margin-top: -30px; margin-bottom: 50px; font-size: 20px; color: gold; display: none;">
                Welcome back!
            </div>

            <div class="products-grid" style="grid-template-columns: repeat(3, 1fr); margin-top: 30px;">
                
                <a href="product.html?id=RO_GEO" class="product-card">
                    <img src="images/product-1.jpg" alt="Rick Owens Geobasket" class="product-image">
                    <div class="product-info">
                        <p class="product-brand">RICK OWENS</p>
                        <h3 class="product-name">GEOBASKET LEATHER SNEAKERS</h3>
                        <p class="product-price">€540</p>
                        <button class="btn-add-details" onclick="event.preventDefault(); alert('Add to cart logic here.');">ADD TO CART</button>
                    </div>
                </a>

                <a href="product.html?id=BAL_TRACK2" class="product-card">
                    <img src="images/product-2.jpg" alt="Balenciaga Track 2" class="product-image">
                    <div class="product-info">
                        <p class="product-brand">BALENCIAGA</p>
                        <h3 class="product-name">TRACK 2 SNEAKERS BLACK</h3>
                        <p class="product-price"><span>€950</span> €428</p>
                        <button class="btn-add-details" onclick="event.preventDefault(); alert('Add to cart logic here.');">ADD TO CART</button>
                    </div>
                </a>
                
                <a href="product.html?id=MM_TABI" class="product-card">
                    <img src="images/product-3.jpg" alt="Maison Margiela Tabi" class="product-image">
                    <div class="product-info">
                        <p class="product-brand">MAISON MARGIELA</p>
                        <h3 class="product-name">TABI ANKLE BOOTS</h3>
                        <p class="product-price">€625</p>
                        <button class="btn-add-details" onclick="event.preventDefault(); alert('Add to cart logic here.');">ADD TO CART</button>
                    </div>
                </a>

            </div>
            
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <p>© 2024 GOTYXAN-PRO — BERLIN</p>
        </div>
    </footer>

    <script>
        // auth должна быть определена в firebase-config.js
        const auth = firebase.auth(); 
        const authLink1 = document.getElementById('auth-link-1');
        const authLink2 = document.getElementById('auth-link-2');

        // --- 1. ФУНКЦИЯ ОБНОВЛЕНИЯ МЕНЮ ---
        function updateNavigation(user) {
            authLink1.innerHTML = '';
            authLink2.innerHTML = '';
            
            const welcomeMessage = document.getElementById('welcome-message');

            if (user) {
                // Пользователь ВОШЕЛ В СИСТЕМУ
                const userName = user.displayName ? user.displayName.split(' ')[0] : user.email;
                welcomeMessage.innerHTML = `Welcome back, <strong>${userName}!</strong>`;
                welcomeMessage.style.display = 'block';

                authLink1.innerHTML = `<a href="profile.html">PROFILE</a>`;
                authLink2.innerHTML = `<a href="#" onclick="logoutUser(event)">LOG OUT</a>`;

            } else {
                // Пользователь НЕ ВОШЕЛ В СИСТЕМУ
                welcomeMessage.style.display = 'none';
                
                authLink1.innerHTML = `<a href="login.html">LOGIN</a>`;
                authLink2.innerHTML = `<a href="register.html">REGISTER</a>`;
            }
        }
        
        // --- 2. ФУНКЦИЯ ВЫХОДА ИЗ СИСТЕМЫ ---
        function logoutUser(event) {
            event.preventDefault(); 
            auth.signOut().then(() => {
                alert("You have been successfully logged out.");
                window.location.reload(); 
            }).catch((error) => {
                console.error("Logout error:", error);
                alert("Error during logout.");
            });
        }

        // --- 3. НАБЛЮДЕНИЕ ЗА СТАТУСОМ АУТЕНТИФИКАЦИИ FIREBASE ---
        auth.onAuthStateChanged((user) => {
            updateNavigation(user);
        });

        // --- 4. ФУНКЦИЯ ОБНОВЛЕНИЯ СЧЕТЧИКА КОРЗИНЫ ---
        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem('gotyxan_cart') || '[]');
            const count = cart.reduce((total, item) => total + item.quantity, 0);
            document.querySelectorAll('.cart-count').forEach(el => {
                el.textContent = count;
            });
        }

        // Инициализация
        document.addEventListener('DOMContentLoaded', () => {
            updateCartCount();
        });
    </script>
</body>
</html>