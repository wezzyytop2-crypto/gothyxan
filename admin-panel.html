<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADMIN DASHBOARD — GOTYXAN-PRO</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
    <script src="firebase-config.js"></script> 
</head>
<body>
    <section class="admin-dashboard-section">
        <div class="container">
            <h1 class="admin-title">DASHBOARD</h1>
            
            <div class="admin-tabs">
                <button class="tab-button active" onclick="openTab(event, 'Products')">
                    <i class="fa-solid fa-box"></i> PRODUCTS
                </button>
                <button class="tab-button" onclick="openTab(event, 'Users')">
                    <i class="fa-solid fa-users"></i> USERS
                </button>
                <button class="tab-button" onclick="openTab(event, 'Analytics')">
                    <i class="fa-solid fa-chart-line"></i> ANALYTICS
                </button>
                <button class="tab-button logout" onclick="logoutAdmin()">
                    <i class="fa-solid fa-right-from-bracket"></i> LOGOUT
                </button>
            </div>

            <div id="Products" class="tab-content active">
                <h2 class="content-title">ADD NEW PRODUCT</h2>
                <form id="add-product-form" class="admin-form">
                    
                    <div class="form-grid">
                        <div class="form-column">
                            <div class="form-group">
                                <label for="product-name">Product Name</label>
                                <input type="text" id="product-name" required>
                            </div>
                            <div class="form-group">
                                <label for="product-brand">Brand</label>
                                <input type="text" id="product-brand" required>
                            </div>
                            <div class="form-group">
                                <label for="product-price">Price (€)</label>
                                <input type="number" id="product-price" required step="0.01">
                            </div>
                            <div class="form-group">
                                <label for="product-old-price">Old Price (Optional)</label>
                                <input type="number" id="product-old-price" step="0.01">
                            </div>
                        </div>

                        <div class="form-column">
                            <div class="form-group">
                                <label for="product-image">Image URL (Photo)</label>
                                <input type="url" id="product-image" required>
                            </div>
                            <div class="form-group">
                                <label for="product-description">Description</label>
                                <textarea id="product-description" rows="5" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="product-sizes">Available Sizes (S, M, L or 40, 41, 42 - separate by comma)</label>
                                <input type="text" id="product-sizes" placeholder="e.g. S, M, L, XL" required>
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-full save-button">SAVE PRODUCT</button>
                    <p id="product-save-message" style="margin-top: 20px; text-align: center; color: green; display: none;">Product added successfully (Simulation).</p>

                    <h3 style="margin-top: 50px;">CURRENT PRODUCTS</h3>
                    <div id="product-list" class="product-list-preview">
                        Loading products...
                    </div>
                </form>
            </div>

            <div id="Users" class="tab-content">
                <h2 class="content-title">REGISTERED USERS (Simulation)</h2>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Email</th>
                            <th>Registration Date</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="users-table-body">
                        <tr><td>1</td><td>user1@example.com</td><td>2025-11-01</td><td>Active</td></tr>
                        <tr><td>2</td><td>user2@test.com</td><td>2025-11-15</td><td>Active</td></tr>
                    </tbody>
                </table>
                <p class="admin-note">
                    *In a real application, this data is retrieved from a secure server database.
                </p>
            </div>

            <div id="Analytics" class="tab-content">
                <h2 class="content-title">SITE VISITS & ANALYTICS (Simulation)</h2>
                <div class="analytics-metrics">
                    <div class="metric-card">
                        <h3>Total Visits</h3>
                        <p class="metric-value">12,540</p>
                    </div>
                    <div class="metric-card">
                        <h3>Unique Users</h3>
                        <p class="metric-value">5,102</p>
                    </div>
                    <div class="metric-card">
                        <h3>Conversion Rate</h3>
                        <p class="metric-value">2.4%</p>
                    </div>
                </div>
                <p class="admin-note">
                    *Actual tracking requires server-side monitoring tools (like Google Analytics or custom logging).
                </p>
            </div>

        </div>
    </section>
    
    <footer class="footer">
        <div class="container">
            <p>© 2024 GOTYXAN-PRO Admin</p>
        </div>
    </footer>

    <script>
        // --- 1. ЛОГИКА ВХОДА/ВЫХОДА И ПРОВЕРКА АУТЕНТИФИКАЦИИ ---
        function logoutAdmin() {
            alert("Logged out successfully.");
            window.location.href = 'admin-login.html';
        }

        // --- 2. ЛОГИКА ВКЛАДОК (TABS) ---
        function openTab(evt, tabName) {
            const tabContents = document.getElementsByClassName("tab-content");
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].style.display = "none";
            }

            const tabButtons = document.getElementsByClassName("tab-button");
            for (let i = 0; i < tabButtons.length; i++) {
                tabButtons[i].classList.remove("active");
            }

            document.getElementById(tabName).style.display = "block";
            if (evt) { evt.currentTarget.classList.add("active"); }
        }

        // --- 3. ЛОГИКА ДОБАВЛЕНИЯ ТОВАРА (Firebase Firestore) ---
        document.getElementById('add-product-form').addEventListener('submit', async function(event) {
            event.preventDefault();

            const newProduct = {
                name: document.getElementById('product-name').value,
                brand: document.getElementById('product-brand').value,
                price: parseFloat(document.getElementById('product-price').value),
                originalPrice: parseFloat(document.getElementById('product-old-price').value) || null,
                image: document.getElementById('product-image').value,
                description: document.getElementById('product-description').value,
                sizes: document.getElementById('product-sizes').value.split(',').map(s => s.trim().toUpperCase()),
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            const message = document.getElementById('product-save-message');

            try {
                await db.collection("products").add(newProduct);
                message.textContent = "Product added successfully!";
                message.style.color = 'green';
                
                this.reset();
                renderProductList(); // Обновляем список

            } catch (error) {
                message.textContent = "Error saving product: " + error.message;
                message.style.color = 'red';
                console.error("Error adding document: ", error);
            }
            
            message.style.display = 'block';
            setTimeout(() => {
                message.style.display = 'none';
            }, 3000);
        });

        // --- 4. ФУНКЦИЯ ДЛЯ ОТОБРАЖЕНИЯ И УДАЛЕНИЯ ТОВАРОВ ---
        async function renderProductList() {
            const listContainer = document.getElementById('product-list');
            listContainer.innerHTML = 'Loading products...';

            try {
                // Получаем товары, отсортированные по дате создания
                const snapshot = await db.collection('products').orderBy('createdAt', 'desc').get();
                listContainer.innerHTML = '';
                
                if (snapshot.empty) {
                    listContainer.innerHTML = '<p style="opacity: 0.7;">No products added yet.</p>';
                    return;
                }

                snapshot.forEach(doc => {
                    const product = doc.data();
                    const itemId = doc.id; // ID документа Firestore

                    const item = document.createElement('div');
                    item.className = 'product-list-item';
                    item.innerHTML = `
                        <img src="${product.image}" alt="${product.name}" style="width: 50px; height: 50px; object-fit: cover;">
                        <div class="product-details">
                            <p><strong>ID: ${itemId} - ${product.name}</strong> (${product.brand})</p>
                            <p>Price: €${product.price} | Sizes: ${product.sizes.join(', ')}</p>
                        </div>
                        <button class="btn-delete" onclick="deleteProduct('${itemId}')">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    `;
                    listContainer.appendChild(item);
                });

            } catch (error) {
                listContainer.innerHTML = `<p style="color: red;">Error loading products: ${error.message}</p>`;
                console.error("Error loading products: ", error);
            }
        }
        
        async function deleteProduct(productId) {
            if (!confirm("Are you sure you want to delete this product?")) return;

            try {
                await db.collection("products").doc(productId).delete();
                alert("Product deleted successfully!");
                renderProductList(); // Обновляем список
            } catch (error) {
                console.error("Error removing document: ", error);
                alert("Error deleting product: " + error.message);
            }
        }
        
        // Инициализация
        document.addEventListener('DOMContentLoaded', () => {
            openTab({currentTarget: document.querySelector('.tab-button.active')}, 'Products'); 
            renderProductList(); 
        });
    </script>
</body>
</html>